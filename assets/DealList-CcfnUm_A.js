var Me=Object.defineProperty;var l=(a,t)=>Me(a,"name",{value:t,configurable:!0});import{u as ne,a as Ge,b as re,c as Be,d as qe,e as U,r as p,f as $e,g as ie,h as He,i as Ue,j as Qe,k as ee,l as e,F as le,m as oe,n as ce,o as de,C as Ke,B as ze,X as We,_ as Je,p as Xe,q as Ye,s as Ze,I as ue,t as xe,R as ea,v as aa,w as ta,x as sa,y as Q,z as fe,A as na,D as me,E as he,P as ra,G as V,H as ge,J as K,K as z,L as W,M as ia,N as la,S as oa,T as ae,O as L,Q as pe,U as ca,V as da,W as M,Y as $,Z as ua,$ as je,a0 as J,a1 as xa,a2 as ve,a3 as fa,a4 as ye,a5 as ma,a6 as ha,a7 as ga,a8 as pa,a9 as ja,aa as va,ab as ya,ac as be,ad as Ce,ae as H,af as ba,ag as Ca,ah as De,ai as Da,aj as Na,ak as wa,al as Pa,am as Sa,an as Fa,ao as _a,ap as Ia,aq as Ta,ar as La,as as k,at as Ra,au as Oa,av as Ea}from"./index-CG3cPToX.js";var R=function(){return R=Object.assign||function(a){for(var t,s=1,r=arguments.length;s<r;s++){t=arguments[s];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(a[n]=t[n])}return a},R.apply(this,arguments)},Aa=function(a,t){var s={};for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&t.indexOf(r)<0&&(s[r]=a[r]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(a);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(a,r[n])&&(s[r[n]]=a[r[n]]);return s},ka=function(a,t,s){if(s||arguments.length===2)for(var r=0,n=t.length,i;r<n;r++)(i||!(r in t))&&(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return a.concat(i||Array.prototype.slice.call(t))},Va=l(function(a){var t,s=a.debounce,r=a.enableGetChoices,n=a.filter,i=a.page,o=i===void 0?1:i,x=a.perPage,f=x===void 0?25:x,c=a.sort,v=c===void 0?{field:"id",order:"DESC"}:c,y=a.queryOptions,d=y===void 0?{}:y,m=a.reference,b=a.source,C=ne().getValues,N=Ge(b),w=(t=re({name:N}))!==null&&t!==void 0?t:C(N),S=d.meta,F=Aa(d,["meta"]),j=Be(m,{ids:w||Ma,meta:S},{enabled:w!=null&&w.length>0}),P=j.data,I=j.error,G=j.isLoading,O=j.isFetching,B=j.isPaused,u=j.isPending,h=j.isPlaceholderData,X=j.refetch,Y=qe({resource:m,page:o,perPage:f,sort:v,debounce:s,filter:n}),g=Y[0],_=Y[1],E=P?P.filter(Boolean):[],Fe=r?r(g.filterValues):!0,D=U(m,{pagination:{page:g.page,perPage:g.perPage},sort:{field:g.sort,order:g.order},filter:R(R({},g.filter),n),meta:S},R({retry:!1,enabled:Fe,placeholderData:l(function(Ve){return Ve},"placeholderData")},F)),T=D.data,q=D.total,A=D.pageInfo,_e=D.error,Ie=D.isLoading,Te=D.isFetching,Le=D.isPaused,Re=D.isPending,Oe=D.isPlaceholderData,Z=D.refetch,Ee=T&&T.length>0?Ga(T,E):E.length>0?E:T,Ae=p.useCallback(function(){X(),Z()},[X,Z]),ke=p.useMemo(function(){return{field:g.sort,order:g.order}},[g.sort,g.order]);return{sort:ke,allChoices:Ee,availableChoices:T,selectedChoices:E,displayedFilters:g.displayedFilters,error:I||_e,filter:n,filterValues:g.filterValues,hideFilter:_.hideFilter,isFetching:O||Te,isLoading:G||Ie,isPaused:B||Le,isPending:u||Re,isPlaceholderData:h||Oe,page:g.page,perPage:g.perPage,refetch:Ae,resource:m,setFilters:_.setFilters,setPage:_.setPage,setPerPage:_.setPerPage,setSort:_.setSort,showFilter:_.showFilter,source:b,total:q,hasNextPage:A?A.hasNextPage:q!=null?g.page*g.perPage<q:void 0,hasPreviousPage:A?A.hasPreviousPage:g.page>1,isFromReference:!0}},"useReferenceArrayInputController"),Ma=[],Ga=l(function(a,t){var s=ka([],a,!0),r=a.map(function(n){return n.id});return t.forEach(function(n){r.includes(n.id)||(r.push(n.id),s.push(n))}),s},"mergeReferences");const Ne=l(a=>{const{filterToQuery:t=Ba,inputText:s}=a,{allChoices:r=[],source:n,resource:i,isFromReference:o,setFilters:x}=$e(a),{id:f,field:c,isRequired:v}=ie({...a,source:n}),y=He(),{placeholder:d=y("ra.action.search",{_:"Search..."})}=a,m=Ue(i),{getChoiceText:b,getChoiceValue:C}=Qe({optionText:a.optionText??(o?m:"name"),optionValue:a.optionValue??"id",disableValue:a.disableValue,translateChoice:a.translateChoice??!o}),N=p.useRef(null),[w,S]=p.useState(!1),F=ee(u=>{c.onChange(c.value.filter(h=>h!==C(u)))}),j=ee(u=>{const h=N.current;h&&((u.key==="Delete"||u.key==="Backspace")&&h.value===""&&c.onChange(c.value.slice(0,-1)),u.key==="Escape"&&h.blur())}),P=r.filter(u=>!c.value.includes(C(u))),I=r.filter(u=>c.value.includes(C(u))),[G,O]=p.useState(""),B=p.useCallback(u=>typeof s=="function"?s(u):s!==void 0?s:b(u),[s,b]);return e.jsxs(le,{className:a.className,id:f,name:c.name,children:[a.label!==!1&&e.jsx(oe,{children:e.jsx(ce,{label:a.label,source:a.source??n,resource:i,isRequired:v})}),e.jsx(de,{children:e.jsxs(Ke,{onKeyDown:j,shouldFilter:!o,className:"overflow-visible bg-transparent",children:[e.jsx("div",{className:"group rounded-md bg-transparent dark:bg-input/30 border border-input px-3 py-1.75 text-sm transition-all ring-offset-background focus-within:border-ring focus-within:ring-ring/50 focus-within:ring-[3px]",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[I.map(u=>e.jsxs(ze,{variant:"outline",children:[B(u),e.jsxs("button",{className:"ml-1 rounded-full outline-none ring-offset-background focus:ring-2 focus:ring-ring focus:ring-offset-2",onKeyDown:l(h=>{h.key==="Enter"&&F(u)},"onKeyDown"),onMouseDown:l(h=>{h.preventDefault(),h.stopPropagation()},"onMouseDown"),onClick:l(h=>{h.preventDefault(),F(u)},"onClick"),children:[e.jsx("span",{className:"sr-only",children:y("ra.action.remove",{_:"Remove"})}),e.jsx(We,{className:"h-3 w-3"})]})]},C(u))),e.jsx(Je.Input,{ref:N,value:G,onValueChange:l(u=>{O(u),o&&x(t(u),void 0,!0)},"onValueChange"),onBlur:l(()=>S(!1),"onBlur"),onFocus:l(()=>S(!0),"onFocus"),placeholder:d,className:"ml-2 flex-1 bg-transparent outline-none placeholder:text-muted-foreground"})]})}),e.jsx("div",{className:"relative",children:e.jsx(Xe,{children:w&&P.length>0?e.jsx("div",{className:"absolute top-2 z-10 w-full rounded-md border bg-popover text-popover-foreground shadow-md outline-none animate-in",children:e.jsx(Ye,{className:"h-full overflow-auto",children:P.map(u=>e.jsx(Ze,{onMouseDown:l(h=>{h.preventDefault(),h.stopPropagation()},"onMouseDown"),onSelect:l(()=>{O(""),o&&x(t("")),c.onChange([...c.value,C(u)])},"onSelect"),className:"cursor-pointer",children:b(u)},C(u)))})}):null})})]})}),e.jsx(ue,{helperText:a.helperText}),e.jsx(xe,{})]})},"AutocompleteArrayInput"),Ba=l(a=>({q:a}),"DefaultFilterToQuery"),qa=l(a=>{const{children:t=$a,reference:s,sort:r,filter:n=Ha}=a;if(p.Children.count(t)!==1)throw new Error("<ReferenceArrayInput> only accepts a single child (like <AutocompleteArrayInput>)");const i=Va({...a,sort:r,filter:n});return e.jsx(ea,{value:s,children:e.jsx(aa,{value:i,children:t})})},"ReferenceArrayInput"),$a=e.jsx(Ne,{}),Ha={},Ua=l(a=>{const{label:t,source:s,className:r,resource:n,validate:i,format:o,parse:x=Qa,onFocus:f,...c}=a,v=ta({resource:n}),{id:y,field:d,isRequired:m}=ie(a),b=l(j=>{const P=j.target.value,I=x(P);N(P),d.onChange(I??0)},"handleChange"),[C,N]=p.useState(d.value?.toString()??""),w=p.useRef(!1),S=l(j=>{f?.(j),w.current=!0},"handleFocus"),F=l(j=>{d.onBlur?.(j),w.current=!1,N(d.value?.toString()??"")},"handleBlur");return p.useEffect(()=>{w.current||N(d.value?.toString()??"")},[d.value]),e.jsxs(le,{id:y,className:r,name:d.name,children:[t!==!1&&e.jsx(oe,{children:e.jsx(ce,{label:t,source:s,resource:v,isRequired:m})}),e.jsx(de,{children:e.jsx(sa,{...c,...d,type:"number",value:C,onChange:b,onFocus:S,onBlur:F})}),e.jsx(ue,{helperText:a.helperText}),e.jsx(xe,{})]})},"NumberInput"),Qa=l(a=>{if(a==null||a==="")return null;const t=parseFloat(a);return isNaN(t)?0:t},"convertStringToNumber"),Ka=l(({deal:a,index:t})=>a?e.jsx(ra,{draggableId:String(a.id),index:t,children:l((s,r)=>e.jsx(we,{provided:s,snapshot:r,deal:a}),"children")}):null,"DealCard"),we=l(({provided:a,snapshot:t,deal:s})=>{const r=Q(),n=l(()=>{r(`/deals/${s.id}/show`,void 0,void 0,void 0,{_scrollToTop:!1})},"handleClick");return e.jsx("div",{className:"cursor-pointer",...a?.draggableProps,...a?.dragHandleProps,ref:a?.innerRef,onClick:n,children:e.jsx(fe,{className:`py-4 transition-all duration-200 ${t?.isDragging?"opacity-90 transform rotate-1 shadow-lg":"shadow-sm hover:shadow-md"}`,children:e.jsxs(na,{className:"px-4 flex",children:[e.jsx(me,{source:"company_id",record:s,reference:"companies",link:!1,children:e.jsx(he,{width:20,height:20})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:s.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.amount.toLocaleString("en-US",{notation:"compact",style:"currency",currency:"USD",currencyDisplay:"narrowSymbol",minimumSignificantDigits:3}),s.category?`, ${s.category}`:""]})]})]})})})},"DealCardContent"),te=l(()=>{const{identity:a}=V(),{data:t,total:s,isPending:r}=U("deals",{pagination:{page:1,perPage:1e3},sort:{field:"archived_at",order:"DESC"},filter:{"archived_at@not.is":null}}),[n,i]=p.useState(!1);if(p.useEffect(()=>{!r&&s===0&&i(!1)},[r,s]),p.useEffect(()=>{i(!1)},[t]),!a||r||!s||!t)return null;const o=t.reduce((x,f)=>{const c=new Date(f.archived_at).toDateString();return x[c]||(x[c]=[]),x[c].push(f),x},{});return e.jsxs("div",{className:"w-full flex flex-row items-center justify-center",children:[e.jsx(ge,{variant:"ghost",onClick:l(()=>i(!0),"onClick"),className:"my-4",children:"View archived deals"}),e.jsx(K,{open:n,onOpenChange:l(()=>i(!1),"onOpenChange"),children:e.jsxs(z,{className:"lg:max-w-4xl overflow-y-auto max-h-9/10 top-1/20 translate-y-0",children:[e.jsx(W,{children:"Archived Deals"}),e.jsx("div",{className:"flex flex-col gap-8",children:Object.entries(o).map(([x,f])=>e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("h4",{className:"font-bold",children:za(x)}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8",children:f.map(c=>e.jsx("div",{children:e.jsx(we,{deal:c})},c.id))})]},x))})]})})]})},"DealArchivedList");function za(a){const t=new Date(a);t.setHours(0,0,0,0);const s=new Date;s.setHours(0,0,0,0);const r=t.getTime()-s.getTime(),n=Math.round(r/(1e3*60*60*24));if(Math.abs(n)>7)return new Intl.DateTimeFormat(void 0,{day:"numeric",month:"long"}).format(t);const i=new Intl.RelativeTimeFormat(void 0,{numeric:"auto"});return Wa(i.format(n,"day"))}l(za,"getRelativeTimeString");function Wa(a){return a.charAt(0).toUpperCase()+a.slice(1)}l(Wa,"ucFirst");function Ja({...a}){return e.jsx(ia,{"data-slot":"visually-hidden",...a})}l(Ja,"VisuallyHidden");const Pe=l(()=>{const a=la();return e.jsxs("div",{className:"flex flex-col gap-8",children:[e.jsx(Xa,{}),e.jsxs("div",{className:`flex gap-6 ${a?"flex-col":"flex-row"}`,children:[e.jsx(Ya,{}),e.jsx(oa,{orientation:a?"horizontal":"vertical"}),e.jsx(Za,{})]})]})},"DealInputs"),Xa=l(()=>e.jsxs("div",{className:"flex flex-col gap-4 flex-1",children:[e.jsx(ae,{source:"name",label:"Deal name",validate:L(),helperText:!1}),e.jsx(ae,{source:"description",multiline:!0,rows:3,helperText:!1})]}),"DealInfoInputs"),Ya=l(()=>{const a=re({name:"company_id"}),{setValue:t}=ne(),s=p.useRef(a);return p.useEffect(()=>{s.current!==void 0&&s.current!==a&&t("contact_ids",[]),s.current=a},[a,t]),e.jsxs("div",{className:"flex flex-col gap-4 flex-1",children:[e.jsx("h3",{className:"text-base font-medium",children:"Linked to"}),e.jsx(pe,{source:"company_id",reference:"companies",children:e.jsx(ca,{validate:L()})}),e.jsx(qa,{source:"contact_ids",reference:"contacts_summary",filter:a?{company_id:a}:void 0,children:e.jsx(Ne,{label:"Contacts",optionText:da,helperText:a?!1:"Please select a company first to see its contacts"})})]})},"DealLinkedToInputs"),Za=l(()=>{const{dealStages:a,dealCategories:t}=M();return e.jsxs("div",{className:"flex flex-col gap-4 flex-1",children:[e.jsx("h3",{className:"text-base font-medium",children:"Misc"}),e.jsx($,{source:"category",label:"Category",choices:t.map(s=>({id:s,name:s})),helperText:!1}),e.jsx(Ua,{source:"amount",defaultValue:0,helperText:!1,validate:L()}),e.jsx(ua,{validate:L(),source:"expected_closing_date",helperText:!1,defaultValue:new Date().toISOString().split("T")[0]}),e.jsx($,{source:"stage",choices:a.map(s=>({id:s.value,name:s.label})),defaultValue:"opportunity",helperText:!1,validate:L()})]})},"DealMiscInputs"),Se=l(({open:a})=>{const t=Q(),s=je(),{data:r}=J(),n=l(()=>{t("/deals")},"handleClose"),i=xa(),o=l(async f=>{if(!r){t("/deals");return}const c=r.filter(d=>d.stage===f.stage&&d.id!==f.id);await Promise.all(c.map(async d=>s.update("deals",{id:d.id,data:{index:d.index+1},previousData:d})));const v=c.reduce((d,m)=>({...d,[m.id]:{...m,index:m.index+1}}),{}),y=Date.now();i.setQueriesData({queryKey:["deals","getList"]},d=>d&&{...d,data:d.data.map(m=>v[m.id]||m)},{updatedAt:y}),t("/deals")},"onSuccess"),{identity:x}=V();return e.jsx(K,{open:a,onOpenChange:l(()=>n(),"onOpenChange"),children:e.jsxs(z,{className:"lg:max-w-4xl overflow-y-auto max-h-9/10 top-1/20 translate-y-0",children:[e.jsxs(Ja,{children:[e.jsx(W,{children:"Create Deal"}),e.jsx(ve,{children:"Create a new deal with company, contacts, and deal information"})]}),e.jsx(fa,{resource:"deals",mutationOptions:{onSuccess:o},children:e.jsxs(ye,{defaultValues:{sales_id:x?.id,contact_ids:[],index:0},children:[e.jsx(Pe,{}),e.jsx(ma,{children:e.jsx(ha,{})})]})})]})})},"DealCreate"),et=l(({open:a,id:t})=>{const s=Q(),r=ga(),n=l(()=>{s("/deals",void 0,void 0,void 0,{_scrollToTop:!1})},"handleClose");return e.jsx(K,{open:a,onOpenChange:l(()=>n(),"onOpenChange"),children:e.jsx(z,{className:"lg:max-w-4xl p-4 overflow-y-auto max-h-9/10 top-1/20 translate-y-0",children:t?e.jsxs(pa,{id:t,mutationMode:"pessimistic",mutationOptions:{onSuccess:l(()=>{r("Deal updated"),s(`/deals/${t}/show`,void 0,void 0,void 0,{_scrollToTop:!1})},"onSuccess")},children:[e.jsx(at,{}),e.jsxs(ye,{children:[e.jsx(Pe,{}),e.jsx(ja,{})]})]}):null})})},"DealEdit");function at(){const a=va();return a?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"pb-0",children:e.jsxs("div",{className:"flex justify-between items-start mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(me,{source:"company_id",reference:"companies",link:"show",children:e.jsx(he,{})}),e.jsxs("h2",{className:"text-2xl font-semibold",children:["Edit ",a.name," deal"]})]}),e.jsxs("div",{className:"flex gap-2 pr-12",children:[e.jsx(ya,{}),e.jsx(ge,{asChild:!0,variant:"outline",className:"h-9",children:e.jsx(be,{to:`/deals/${a.id}/show`,children:"Back to deal"})})]})]})}),e.jsx(ve,{className:"sr-only",children:"Edit deal information including name, company, contacts, and other details"})]}):null}l(at,"EditHeader");const tt=l(({children:a})=>{const t=Ce(),s=H("/deals/create",t.pathname),r=ba(),{data:n,isPending:i}=U("contacts",{pagination:{page:1,perPage:1}});return i?e.jsx(Ca,{value:50}):e.jsxs("div",{className:"flex flex-col justify-center items-center gap-12",style:{height:`calc(100dvh - ${r}px)`},children:[e.jsx("img",{src:"./img/empty.svg",alt:"No deals found"}),n&&n.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center gap-0",children:[e.jsx("h3",{className:"text-lg font-bold",children:"No deals found"}),e.jsx("p",{className:"text-sm text-center text-muted-foreground mb-4",children:"It seems your deal list is empty."})]}),e.jsx("div",{className:"flex space-x-8",children:e.jsx(De,{label:"Create deal"})}),e.jsx(Se,{open:!!s}),a]}):e.jsxs("div",{className:"flex flex-col items-center gap-0",children:[e.jsx("h3",{className:"text-lg font-bold",children:"No deals found"}),e.jsxs("p",{className:"text-sm text-center text-muted-foreground mb-4",children:["It seems your contact list is empty.",e.jsx("br",{}),e.jsx(be,{to:"/contacts/create",className:"hover:underline",children:"Add your first contact"})," ","before creating a deal."]})]})]})},"DealEmpty"),st=l(({stage:a,deals:t})=>{const s=t.reduce((n,i)=>n+i.amount,0),{dealStages:r}=M();return e.jsxs("div",{className:"flex-1 pb-8",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h3",{className:"text-base font-medium",children:Da(r,a)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.toLocaleString("en-US",{notation:"compact",style:"currency",currency:"USD",currencyDisplay:"narrowSymbol",minimumSignificantDigits:3})})]}),e.jsx(Na,{droppableId:a,children:l((n,i)=>e.jsxs("div",{ref:n.innerRef,...n.droppableProps,className:`flex flex-col rounded-2xl mt-2 gap-2 ${i.isDraggingOver?"bg-muted":""}`,children:[t.map((o,x)=>e.jsx(Ka,{deal:o,index:x},o.id)),n.placeholder]}),"children")})]})},"DealColumn"),se=l((a,t)=>{if(!t)return{};const s=a.reduce((r,n)=>(r[n.stage]&&r[n.stage].push(n),r),t.reduce((r,n)=>({...r,[n.value]:[]}),{}));return t.forEach(r=>{s[r.value]=s[r.value].sort((n,i)=>n.index-i.index)}),s},"getDealsByStage"),nt=l(()=>{const{dealStages:a}=M(),{data:t,isPending:s,refetch:r}=J(),n=je(),[i,o]=p.useState(se([],a));if(p.useEffect(()=>{if(t){const f=se(t,a);wa(f,i)||o(f)}},[t]),s)return null;const x=l(f=>{const{destination:c,source:v}=f;if(!c||c.droppableId===v.droppableId&&c.index===v.index)return;const y=v.droppableId,d=c.droppableId,m=i[y][v.index],b=i[d][c.index]??{stage:d,index:void 0};o(rt(m,{stage:y,index:v.index},{stage:d,index:c.index},i)),it(m,b,n).then(()=>{r()})},"onDragEnd");return e.jsx(Pa,{onDragEnd:x,children:e.jsx("div",{className:"flex gap-4",children:a.map(f=>e.jsx(st,{stage:f.value,deals:i[f.value]},f.value))})})},"DealListContent"),rt=l((a,t,s,r)=>{if(t.stage===s.stage){const n=r[t.stage];return n.splice(t.index,1),n.splice(s.index??n.length+1,0,a),{...r,[s.stage]:n}}else{const n=r[t.stage],i=r[s.stage];return n.splice(t.index,1),i.splice(s.index??i.length+1,0,a),{...r,[t.stage]:n,[s.stage]:i}}},"updateDealStageLocal"),it=l(async(a,t,s)=>{if(a.stage===t.stage){const{data:r}=await s.getList("deals",{sort:{field:"index",order:"ASC"},pagination:{page:1,perPage:100},filter:{stage:a.stage}}),n=t.index??r.length+1;a.index>n?await Promise.all([...r.filter(i=>i.index>=n&&i.index<a.index).map(i=>s.update("deals",{id:i.id,data:{index:i.index+1},previousData:i})),s.update("deals",{id:a.id,data:{index:n},previousData:a})]):await Promise.all([...r.filter(i=>i.index<=n&&i.index>a.index).map(i=>s.update("deals",{id:i.id,data:{index:i.index-1},previousData:i})),s.update("deals",{id:a.id,data:{index:n},previousData:a})])}else{const[{data:r},{data:n}]=await Promise.all([s.getList("deals",{sort:{field:"index",order:"ASC"},pagination:{page:1,perPage:100},filter:{stage:a.stage}}),s.getList("deals",{sort:{field:"index",order:"ASC"},pagination:{page:1,perPage:100},filter:{stage:t.stage}})]),i=t.index??n.length+1;await Promise.all([...r.filter(o=>o.index>a.index).map(o=>s.update("deals",{id:o.id,data:{index:o.index-1},previousData:o})),...n.filter(o=>o.index>=i).map(o=>s.update("deals",{id:o.id,data:{index:o.index+1},previousData:o})),s.update("deals",{id:a.id,data:{index:i,stage:t.stage},previousData:a})])}},"updateDealStage"),lt=l(a=>{const{filterValues:t,displayedFilters:s,setFilters:r}=Sa(),{identity:n}=V(),i=l(()=>{const o={...t};typeof t.sales_id<"u"?delete o.sales_id:o.sales_id=n&&n?.id,r(o,s)},"handleChange");return e.jsx("div",{className:"mt-auto pb-2.25",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Fa,{id:"only-mine",checked:typeof t.sales_id<"u",onCheckedChange:i}),e.jsx(_a,{htmlFor:"only-mine",children:"Only companies I manage"})]})})},"OnlyMineInput"),xt=l(()=>{const{dealCategories:a}=M(),t=[e.jsx(Ia,{source:"q",alwaysOn:!0}),e.jsx(pe,{source:"company_id",reference:"companies",children:e.jsx(Ta,{label:!1,placeholder:"Company"})}),e.jsx($,{source:"category",emptyText:"Category",choices:a.map(s=>({id:s,name:s}))}),e.jsx(lt,{source:"sales_id",alwaysOn:!0})];return e.jsx(La,{perPage:100,filter:{"archived_at@is":null},title:!1,sort:{field:"index",order:"DESC"},filters:t,actions:e.jsx(ct,{}),pagination:null,children:e.jsx(ot,{})})},"DealList"),ot=l(()=>{const a=Ce(),t=H("/deals/create",a.pathname),s=H("/deals/:id",a.pathname),{data:r,isPending:n,filterValues:i}=J(),{identity:o}=V(),x=i&&Object.keys(i).length>0;return!o||n?e.jsx("div",{className:"w-full",children:e.jsx(fe,{className:"p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(k,{className:"h-96 w-1/4"}),e.jsx(k,{className:"h-96 w-1/4"}),e.jsx(k,{className:"h-96 w-1/4"}),e.jsx(k,{className:"h-96 w-1/4"})]})})}):!r?.length&&!x?e.jsx(e.Fragment,{children:e.jsx(tt,{children:e.jsx(te,{})})}):e.jsxs("div",{className:"w-full",children:[e.jsx(nt,{}),e.jsx(te,{}),e.jsx(Se,{open:!!t}),e.jsx(et,{open:!!s&&!t,id:s?.params.id})]})},"DealLayout"),ct=l(()=>e.jsxs(Ra,{children:[e.jsx(Oa,{}),e.jsx(Ea,{}),e.jsx(De,{label:"New Deal"})]}),"DealActions");export{xt as default};
//# sourceMappingURL=DealList-CcfnUm_A.js.map
